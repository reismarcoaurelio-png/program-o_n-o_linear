<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<title>Simplex KKT Automático</title>
<style>
body{font-family:Arial;padding:20px;background:#f7f9fb;}
table{border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #999;padding:5px;text-align:center;}
th{background:#eee;}
</style>
</head>
<body>
<h1>Simplex KKT Automático - Max Quadrático</h1>

<p>Problema:</p>
<pre>
Max z = -x1² + 6x1 - 2x2² + 8x2
Sujeito a: 2x1 + 4x2 ≤ 8
x1 ≥ 0, x2 ≥ 0
</pre>

<div id="iterations"></div>

<script>
// Variáveis
const varNames=['x1','x2','x3','y1','y2','y3'];

// Base inicial: [x3, y1, y2]
let base=['x3','y1','y2'];
let A=[
  [2,4,1,0,0,0],
  [-2,0,0,1,0,-2],
  [0,-4,0,0,1,-4]
];
let b=[8,-6,-8];
let iterations=[];

function saveIteration(pivotRow=-1,pivotCol=-1){
  iterations.push({
    base:[...base],
    A:A.map(r=>[...r]),
    b:[...b],
    pivotRow,
    pivotCol
  });
}

// Pivot
function pivot(row,col){
  const pivotVal=A[row][col];
  for(let j=0;j<A[row].length;j++) A[row][j]/=pivotVal;
  b[row]/=pivotVal;
  for(let i=0;i<A.length;i++){
    if(i===row) continue;
    let factor=A[i][col];
    for(let j=0;j<A[i].length;j++) A[i][j]-=factor*A[row][j];
    b[i]-=factor*b[row];
  }
  base[row]=varNames[col];
  saveIteration(row,col);
}

// Variável que entra: mais negativa fora da base
function enteringVar(){
  let minVal=0, idx=-1;
  for(let j=0;j<varNames.length;j++){
    if(!base.includes(varNames[j])){
      let val=0;
      for(let i=0;i<A.length;i++) val+=A[i][j]; // simplificação para teste
      if(val<minVal){ minVal=val; idx=j;}
    }
  }
  return idx;
}

// Variável que sai: complementar da que entra
function leavingVar(enterCol){
  for(let i=0;i<base.length;i++){
    const bv=base[i];
    const comp=(bv.startsWith('x')?'y'+bv.slice(1):'x'+bv.slice(1));
    if(varNames[enterCol]===comp) return i;
  }
  return -1;
}

// Iterar até ótimo
saveIteration();
while(true){
  const enter=enteringVar();
  if(enter===-1) break;
  const leave=leavingVar(enter);
  if(leave===-1) break;
  pivot(leave,enter);
}

// Mostrar
const area=document.getElementById('iterations');
iterations.forEach((it,i)=>{
  const div=document.createElement('div');
  div.innerHTML=`<strong>Iteração ${i+1}</strong>`;
  const tbl=document.createElement('table');
  const trh=document.createElement('tr');
  trh.innerHTML='<th>Base</th>'+varNames.map(v=>`<th>${v}</th>`).join('')+'<th>b</th>';
  tbl.appendChild(trh);
  for(let r=0;r<it.base.length;r++){
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${it.base[r]}</td>`+
      it.A[r].map(v=>`<td>${v.toFixed(4)}</td>`).join('')+
      `<td>${it.b[r].toFixed(4)}</td>`;
    tbl.appendChild(tr);
  }
  div.appendChild(tbl);
  area.appendChild(div);
});
</script>
</body>
</html>
