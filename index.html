<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Simplex KKT Manual - Frações Aceitas</title>
<style>
body{font-family:Arial,sans-serif;padding:18px;background:#f7f9fb;color:#111}
h1{font-size:22px;margin-bottom:12px}
.input-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px;}
input[type="number"], input[type="text"]{padding:6px 8px;border-radius:6px;border:1px solid #cbd5e1;width:80px;text-align:right}
input.basicVar{width:60px;text-align:center}
button{padding:8px 12px;border-radius:6px;border:none;cursor:pointer;background:#2563eb;color:white;margin-top:5px}
table{border-collapse:collapse;margin-top:12px}
th,td{border:1px solid #999;padding:6px;text-align:center}
td.correct{background:#dcfce7;color:#065f46}
td.wrong{background:#fee2e2;color:#9b1c1c}
.status{padding:8px;border-radius:6px;margin-top:10px}
.ok{background:#dcfce7;color:#065f46}
.error{background:#fee2e2;color:#9b1c1c}
</style>
</head>
<body>

<h1>Simplex KKT Manual - Max z = -x1² +6x1 -2x2² +8x2</h1>

<div class="input-row">
<label>Aluno:</label>
<input id="studentName" type="text" placeholder="Digite seu nome"/>
<button id="build">Iniciar</button>
</div>

<div id="problemArea"></div>
<div id="iterationsArea"></div>
<div id="feedback" class="status">Clique em "Iniciar" para gerar a primeira tabela.</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const varNames = ['x1','x2','x3','y1','y2','y3']; 
let studentName = '';
let currentTableau = 0;

// --- Função para interpretar frações ---
function parseInput(val){
  val = val.trim();
  if(val.includes('/')){
    const parts = val.split('/');
    return parseFloat(parts[0])/parseFloat(parts[1]);
  } else {
    return parseFloat(val);
  }
}

// --- Tabelas preparadas (KKT) ---
const tableaux = [
  // Iteração 1
  {
    baseVars:['x3','y1','y2'],
    A:[
      [2,4,1,0,0,0],
      [-2,0,0,1,0,-2],
      [0,-4,0,0,1,-4]
    ],
    b:[8,-6,-8]
  },
  // Iteração 2 (x2 entra, y2 sai)
  {
    baseVars:['x3','y1','x2'],
    A:[
      [2,0,1,0,1,-4],
      [-2,0,0,1,0,-2],
      [0,1,0,0,0,0.25]
    ],
    b:[0,-6,1]
  }
];

// --- Inicialização ---
function buildProblem(){
  studentName = document.getElementById('studentName').value.trim();
  if(!studentName){ alert('Digite seu nome!'); return; }

  document.getElementById('problemArea').innerHTML = `<strong>Problema:</strong><br>
  Max z = -x1² +6x1 -2x2² +8x2<br>
  Sujeito a: 2x1+4x2 ≤ 8, x1≥0, x2≥0<br>
  Variável de folga: x3<br>
  Multiplicadores KKT: y1,y2,y3<br>
  Preencha a tabela manualmente e clique em "Verificar Iteração".`;

  renderTableau(currentTableau);
}

// --- Render tabela ---
function renderTableau(idx){
  const tableau = tableaux[idx];
  const area = document.getElementById('iterationsArea');
  area.innerHTML = `<strong>Iteração ${idx+1}:</strong>`;
  const tbl = document.createElement('table');

  // Cabeçalho
  const thead = document.createElement('thead');
  const htr = document.createElement('tr');
  htr.innerHTML = '<th>Base</th>' + varNames.map(v=>`<th>${v}</th>`).join('') + '<th>b</th>';
  thead.appendChild(htr);
  tbl.appendChild(thead);

  // Corpo
  const tbody = document.createElement('tbody');
  for(let i=0;i<tableau.baseVars.length;i++){
    const tr = document.createElement('tr');
    // Base
    const tdBase = document.createElement('td');
    const inputBase = document.createElement('input');
    inputBase.type='text'; inputBase.className='basicVar';
    inputBase.dataset.row=i;
    tdBase.appendChild(inputBase);
    tr.appendChild(tdBase);
    // Coeficientes
    for(let j=0;j<varNames.length;j++){
      const td = document.createElement('td');
      const input = document.createElement('input');
      input.type='text';
      input.dataset.row=i;
      input.dataset.col=j;
      td.appendChild(input);
      tr.appendChild(td);
    }
    // b
    const tdB = document.createElement('td');
    const inputB = document.createElement('input');
    inputB.type='text';
    inputB.dataset.row=i;
    inputB.dataset.b=true;
    tdB.appendChild(inputB);
    tr.appendChild(tdB);

    tbody.appendChild(tr);
  }
  tbl.appendChild(tbody);
  area.appendChild(tbl);

  const btn = document.createElement('button');
  btn.innerText='Verificar Iteração';
  btn.addEventListener('click',()=>checkTableau(idx));
  area.appendChild(btn);
}

// --- Verificação ---
function checkTableau(idx){
  const tableau = tableaux[idx];
  let correct=0, total=0;

  // Base
  const inputsBase = document.querySelectorAll('input.basicVar');
  inputsBase.forEach((inp,i)=>{
    total++;
    if(inp.value.trim()===tableau.baseVars[i]) inp.parentElement.className='correct', correct++;
    else inp.parentElement.className='wrong';
  });

  // Coeficientes
  for(let i=0;i<tableau.baseVars.length;i++){
    for(let j=0;j<varNames.length;j++){
      total++;
      const inp = document.querySelector(`input[data-row='${i}'][data-col='${j}']`);
      if(Math.abs(parseInput(inp.value) - tableau.A[i][j])<1e-2) inp.parentElement.className='correct', correct++;
      else inp.parentElement.className='wrong';
    }
  }

  // b
  for(let i=0;i<tableau.baseVars.length;i++){
    total++;
    const inp = document.querySelector(`input[data-row='${i}'][data-b]`);
    if(Math.abs(parseInput(inp.value) - tableau.b[i])<1e-2) inp.parentElement.className='correct', correct++;
    else inp.parentElement.className='wrong';
  }

  const fb = document.getElementById('feedback');
  fb.innerText=`Iteração ${idx+1}: ${correct}/${total} valores corretos`;
  fb.className='status '+(correct===total?'ok':'error');

  // Avançar para próxima iteração
  if(idx+1<tableaux.length){
    currentTableau++;
    renderTableau(currentTableau);
  } else {
    fb.innerText += " ✅ Todas as iterações completadas!";
  }
}

document.getElementById('build').addEventListener('click',buildProblem);
</script>
</body>
</html>
