<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Simplex KKT - Interativo para Aluno</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f7f9fb; }
table { border-collapse: collapse; margin-top:10px; }
th, td { border:1px solid #999; padding:5px; text-align:center; }
th { background:#eee; }
input { width:60px; text-align:center; }
button { padding:6px 10px; margin:5px; }
.status { margin-top:10px; padding:8px; border-radius:5px; }
.ok { background:#dcfce7; color:#065f46; }
.error { background:#fee2e2; color:#9b1c1c; }
</style>
</head>
<body>

<h1>Simplex KKT - Quadrático Interativo</h1>

<label>Nome do aluno: <input id="studentName" type="text"></label><br><br>

<p>Defina seu problema:</p>
Função objetivo: <input id="objFunc" placeholder="Ex: -x1^2 +6*x1 -2*x2^2 +8*x2"><br>
Restrição 1: <input id="r1" placeholder="Ex: 2*x1 +4*x2 <= 8"><br>
Restrição 2: <input id="r2" placeholder="Ex: -2*x1 <= -6"><br>
<!-- pode adicionar mais restrições se quiser -->

<button id="start">Iniciar Iterações</button>
<div id="iterationsArea"></div>
<div class="status" id="feedback">Preencha o problema e clique em "Iniciar Iterações".</div>
<button id="finalize" style="display:none;">Finalizar e Gerar Relatório</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// --- Variáveis ---
let varNames = []; // x1,x2,... e y1,y2,...
let autoIterations = [];
let currentIter = 0;
let base = [];
let A = [];
let b = [];
let studentName = "";

// --- Funções auxiliares ---
function parseConstraint(str){
    // transforma "2*x1 + 4*x2 <= 8" em [2,4,8] e tipo '<='
    const m = str.match(/(.*)(<=|>=|=)(.*)/);
    if(!m) return null;
    const lhs = m[1].trim();
    const op = m[2];
    const rhs = parseFloat(m[3]);
    const coefs = [];
    varNames.forEach(v=>{
        const regex = new RegExp(v+'\\b','g');
        const match = lhs.match(regex);
        if(match){
            const coefMatch = lhs.split(v)[0].match(/([-+]?[\d\.]*)$/);
            let coef = coefMatch ? parseFloat(coefMatch[0]||1) : 1;
            coefs.push(coef);
        } else coefs.push(0);
    });
    return {coefs,op,rhs};
}

function saveAutoIteration(){
  autoIterations.push({
    base:[...base],
    A:A.map(r=>[...r]),
    b:[...b]
  });
}

// --- Pivot, enteringVar e isOptimal podem ser reaproveitados do seu código anterior ---

// --- Render ---
function renderStudentIteration(iterIdx){
    const area = document.getElementById('iterationsArea');
    area.innerHTML=`<h3>Iteração ${iterIdx+1}</h3>`;
    const tbl = document.createElement('table');
    const trh = document.createElement('tr');
    trh.innerHTML='<th>Base</th>'+varNames.map(v=>`<th>${v}</th>`).join('')+'<th>b</th>';
    tbl.appendChild(trh);
    const n = base.length;
    for(let r=0;r<n;r++){
        const tr = document.createElement('tr');
        tr.innerHTML=`<td><input type="text" id="base_${r}"></td>`+
          varNames.map((v,j)=>`<td><input type="text" id="cell_${r}_${j}"></td>`).join('')+
          `<td><input type="text" id="b_${r}"></td>`;
        tbl.appendChild(tr);
    }
    area.appendChild(tbl);
}

// --- Eventos ---
document.getElementById('start').addEventListener('click',()=>{
    studentName = document.getElementById('studentName').value.trim() || 'Aluno';
    const xInput = document.getElementById('objFunc').value;
    const r1 = document.getElementById('r1').value;
    const r2 = document.getElementById('r2').value;

    // Detectar variáveis x1, x2,...
    const xSet = new Set(xInput.match(/x\d+/g));
    varNames = Array.from(xSet).sort();

    // Adicionar variáveis de folga
    varNames.push('x'+(varNames.length+1)); // x3 folga
    // Adicionar variáveis duais correspondentes
    varNames.push('y1','y2');

    // Inicializar base e A/b
    base = ['x3','y1','y2'];
    A = [
        [2,4,1,0,0,0],
        [-2,0,0,1,0,-2],
        [0,-4,0,0,1,-4]
    ];
    b = [8,-6,-8];

    renderStudentIteration(0);
});

</script>
</body>
</html>

