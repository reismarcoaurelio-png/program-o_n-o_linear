<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Simplex KKT - Quadrático Automático</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background:#f7f9fb; }
table { border-collapse: collapse; margin-top:10px; }
th, td { border:1px solid #999; padding:5px; text-align:center; }
th { background:#eee; }
button { padding:6px 10px; margin:5px; }
.status { margin-top:10px; padding:8px; border-radius:5px; }
.ok { background:#dcfce7; color:#065f46; }
.error { background:#fee2e2; color:#9b1c1c; }
</style>
</head>
<body>
<h1>Simplex KKT - Quadrático Automático teste</h1>

<p>Problema:</p>
<pre>
Max z = -x1² + 6x1 - 2x2² + 8x2
Sujeito a: 2x1 + 4x2 ≤ 8
x1 ≥ 0, x2 ≥ 0
</pre>

<button id="autoSolve">Resolver Automaticamente</button>
<div id="iterations"></div>
<div class="status" id="feedback">Clique em "Resolver Automaticamente" para ver as iterações.</div>

<script>
// --- Variáveis ---
const varNames = ['x1','x2','x3','y1','y2','y3']; // x3=folga, y's=complementares
let base = ['x3','y1','y2']; // base inicial
let A = [
  [2, 4, 1, 0, 0, 0],   // restrição + folga
  [-2, 0, 0, 1, 0, -2], // d/dx1
  [0, -4, 0, 0, 1, -4]  // d/dx2
];
let b = [8, -6, -8];
let iterations = [];

// --- Funções ---
function saveIteration() {
  iterations.push({
    base: [...base],
    A: A.map(r => [...r]),
    b: [...b]
  });
}

// Pivot
function pivot(row, col) {
  const pivotVal = A[row][col];
  for(let j=0;j<A[row].length;j++) A[row][j]/=pivotVal;
  b[row]/=pivotVal;
  for(let i=0;i<A.length;i++){
    if(i===row) continue;
    const factor = A[i][col];
    for(let j=0;j<A[i].length;j++) A[i][j] -= factor*A[row][j];
    b[i] -= factor*b[row];
  }
  base[row] = varNames[col];
  saveIteration();
}

// Encontra a variável que entra: complementar da mais negativa da base
function enteringVar(){
  let minVal = 0, row=-1;
  for(let i=0;i<b.length;i++){
    if(b[i]<minVal){
      minVal = b[i];
      row = i;
    }
  }
  if(row===-1) return null;
  const leavingVar = base[row];
  const enterVar = leavingVar.startsWith('x') ? 'y'+leavingVar.slice(1) : 'x'+leavingVar.slice(1);
  const col = varNames.indexOf(enterVar);
  return {row,col};
}

// Verifica se ótimo
function isOptimal(){
  return b.every(v=>v>=0);
}

// Itera automaticamente
function solveAutomatic(){
  // reset
  base = ['x3','y1','y2'];
  A = [
    [2, 4, 1, 0, 0, 0],
    [-2, 0, 0, 1, 0, -2],
    [0, -4, 0, 0, 1, -4]
  ];
  b = [8,-6,-8];
  iterations=[];
  saveIteration();

  while(!isOptimal()){
    const pivotPos = enteringVar();
    if(!pivotPos) break;
    pivot(pivotPos.row, pivotPos.col);
  }

  renderIterations();
}

// Renderiza as iterações
function renderIterations(){
  const area = document.getElementById('iterations');
  area.innerHTML='';
  iterations.forEach((it,i)=>{
    const div = document.createElement('div');
    div.innerHTML=`<strong>Iteração ${i+1}</strong>`;
    const tbl = document.createElement('table');
    const trh = document.createElement('tr');
    trh.innerHTML='<th>Base</th>'+varNames.map(v=>`<th>${v}</th>`).join('')+'<th>b</th>';
    tbl.appendChild(trh);
    for(let r=0;r<it.base.length;r++){
      const tr = document.createElement('tr');
      tr.innerHTML=`<td>${it.base[r]}</td>`+
        it.A[r].map(v=>`<td>${v}</td>`).join('')+
        `<td>${it.b[r]}</td>`;
      tbl.appendChild(tr);
    }
    div.appendChild(tbl);
    area.appendChild(div);
  });
  document.getElementById('feedback').innerText='✅ Resolução automática completa.';
  document.getElementById('feedback').className='status ok';
}

// --- Eventos ---
document.getElementById('autoSolve').addEventListener('click', solveAutomatic);
</script>
</body>
</html>

